# CLAUDE.md

## IMPORTANT

- 変更作業を始める前に、必ず `git pull --rebase` を実行して最新状態に同期する。
- 変更をコミットしたら、すぐに `git push` する。

## 不具合対応の原則

「ログを足して現象を追う」より先に、設計上の前提（契約）を見直して構造で潰す。

- まず **不変条件（Invariant）** を言語化する（例：deep link は失われない／同一ファイルの同一性は一意／UI失敗で再生は止まらない）
- **失敗モード**（順序競合・再送・二重実行・部分失敗・再起動）を列挙し、設計で吸収する
- **境界（main/renderer、UI/Domain、外部API）** ごとに責務を分離し、手続きの連鎖ではなく「コマンド＋結果」の形にする
- 同一性は **安定キー（id/path_lower 等）** に統一し、表示用文字列に依存しない
- 追加ログは最後の手段。必要なら「イベント／状態遷移」が観測できる設計にする

PR では、修正が「症状への対処」ではなく「前提の是正」になっているかを必ず確認する。
